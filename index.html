<html>
  <head>
    <title>My first three.js app</title>
    <style>
      body { margin: 0; }
      canvas { width: 100%; height: 100% }
    </style>
  </head>
  <body>
    <script src="js/three.js"></script>
    <script src="js/OrbitControls.js"></script>
    <script src="js/STLLoader.js"></script>
    <script src="js/duplo.js"></script>
    <script>
      const SETTINGS = {
        world: {x:10, y:5, z:10},
        //block: {x:3.2, y:2, z:3.2},
        //tube: {r:1.4}
        //block: {x:31.7, y:42.75/2, z:31.7},
        block: {x:30, y:38/2, z:30},
        tube: {r:14}
      };

      let scene = new THREE.Scene();
      let camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

      let renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );
      renderer.setClearColor(0xffffff);
      document.body.appendChild( renderer.domElement );

      let grid = new Grid(SETTINGS);
      scene.add(grid.getMesh());

      let cursor = new Cursor(grid, SETTINGS);
      grid.getMesh().add(cursor.getMesh());

      let directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);
      directionalLight.position.set(-1, 0.8, 0.6);
      scene.add(directionalLight);

      directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
      directionalLight.position.set(1, -0.8, -0.6);
      scene.add(directionalLight);

      let ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
      scene.add(ambientLight);

      const scale = 1.0;
      camera.position.set(SETTINGS.block.x * SETTINGS.world.x * 0.3 * scale, SETTINGS.block.y * SETTINGS.world.y * 2 * scale, SETTINGS.block.z * SETTINGS.world.z * scale);

      let render = function () {
        requestAnimationFrame( render );
        renderer.render(scene, camera);
      };

      const controls = new THREE.OrbitControls( camera, renderer.domElement );
      controls.addEventListener( 'change', render ); // remove when using animation loop
      controls.enableZoom = false;
      controls.enableKeys = false;

      render();

      document.addEventListener('keyup', (event) =>{
        if (event.key === ' ') {
          cursor.start();
        }
        else if (event.key === 'Enter') {
          cursor.track.toDuplo();
        }
        else if (event.key === 'ArrowUp') {
          cursor.moveBack();
        }
        else if (event.key === 'ArrowDown') {
          cursor.moveFront();
        }
        else if (event.key === 'ArrowLeft') {
          cursor.moveLeft();
        }
        else if (event.key === 'ArrowRight') {
          cursor.moveRight();
        }
        else if (event.key === 'a') {
          cursor.moveTop();
        }
        else if (event.key === 'z') {
          cursor.moveBottom();
        }
      });
    </script>
  </body>
</html>
